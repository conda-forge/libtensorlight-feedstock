From 2be2218388efa2aee1751d98605a16374e812c4f Mon Sep 17 00:00:00 2001
From: Lori Burns <lori.burns@gmail.com>
Date: Tue, 18 Jul 2023 02:02:54 -0400
Subject: [PATCH] add netlib feature and cblas link

---
 CMakeLists.txt     | 5 ++++-
 build_libtensor.py | 4 +++-
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 66f7169e..96e6d6be 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -59,12 +59,15 @@ elseif(BLA_VENDOR STREQUAL "Intel10_64lp_seq" OR BLA_VENDOR STREQUAL "Intel10_64
    get_filename_component(BLAS_DIR ${BLAS_LIB} DIRECTORY)
    find_file(MKLINCLUDE mkl.h HINTS "${BLAS_DIR}/../include" "${BLAS_DIR}/../../include")
    get_filename_component(BLAS_INCLUDE_DIR ${MKLINCLUDE} DIRECTORY)
+elseif(BLA_VENDOR STREQUAL "Generic")
+   find_library(CBLAS_LIBRARY NAMES cblas)
 else()
    # TODO If more blas vendors are supported do not forget to add them to
    #      libtensor/linalg/BlasSequential.C and libtensor/CMakeLists.txt
    message(WARNING "BLAS vendor ${BLA_VENDOR} has not been tested with libtensorlight")
 endif()
-set(BLAS_LAPACK_LIBRARIES ${BLAS_LIBRARIES})
+set(BLAS_LAPACK_LIBRARIES ${BLAS_LIBRARIES} ${CBLAS_LIBRARY})
+message("BLAS_LAPACK_LIBRARIES ${BLAS_LAPACK_LIBRARIES}")
 
 ##########################################################################
 # Libxm dependencies
diff --git a/build_libtensor.py b/build_libtensor.py
index 7ce16e58..c9b3fdbf 100755
--- a/build_libtensor.py
+++ b/build_libtensor.py
@@ -58,6 +58,8 @@ def configure(build_dir, source_dir, install_dir, build_type=None, features=[],
     if "mkl" in features:
         # Use sequential Intel MKL version
         args += ["-DBLA_VENDOR=Intel10_64lp_seq"]
+    if "netlib" in features:
+        args += ["-DBLA_VENDOR=Generic"]
 
     subprocess.check_call(args + [source_dir], cwd=build_dir)
 
@@ -127,7 +129,7 @@ def main():
                         help="The build type to configure.")
     parser.add_argument("--features", default=[],
                         nargs="+", help="Select optional features for build.",
-                        choices=["libxm", "mkl", "mpi"])
+                        choices=["libxm", "mkl", "mpi", "netlib"])
     parser.add_argument("--documentation", default=False, action="store_true",
                         help="Build documentation using doxygen.")
 
-- 
2.39.2 (Apple Git-143)

